<!doctype html>

<title>CodeMirror: MMT Autocomplete Demo</title>
<meta charset="utf-8"/>

<link rel="stylesheet" href="../exports/CodeMirror/lib/codemirror.css">
<link rel="stylesheet" href="../exports/CodeMirror/addon/hint/show-hint.min.css">

<!-- vvv update the version here if you update the ../exports/CodeMirror Git submodule -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.1/codemirror.min.js"></script>
<script src="../exports/CodeMirror/addon/hint/show-hint.min.js"></script>

<script src="../exports/CodeMirror/addon/mode/advanced.js"></script>
<script src="../exports/CodeMirror/mode/mmt/mmt.js"></script>

<article>
<h2>Autocomplete Demo</h2>
<form><textarea id="code" name="code">namespace http://example.com/mmt-demo ‚ùö

import lfx http://gl.mathhub.info/MMT/LFX/TypedHierarchy ‚ùö
import finite http://gl.mathhub.info/MMT/LFX/Finite ‚ùö
import rules scala://structuralfeatures.lf.mmt.kwarc.info‚ùö

theory Notations =
	Pi      # { V1T,‚Ä¶ } 2 prec -10000‚ùô
	lambda  # [ V1T,‚Ä¶ ] 2 prec -10000‚ùô
	apply   # 1%w‚Ä¶        prec -10‚ùô
	arrow   # 1‚ü∂‚Ä¶        prec  -9990‚ùô
	case    # [ V2T,‚Ä¶ ] 1 ‚áù 3 prec 5‚ùô
‚ùö

// Views ‚ùö
view emptyView : ?S -> ?T = ‚ùö

view v : ?S -> ?T =
	a = b ‚ùô
	c = d ‚ùô
‚ùö</textarea></form>

<p>Press <strong>ctrl-space</strong> to activate autocompletion.</p>

<script>
function loadAbbreviations() {
  return new Map(
    getRawAbbreviations()
      .split('\n')
      .filter(line => line != '' && !line.startsWith('//'))
      .map(line => line.split('|'))
  );
}

const abbreviations = loadAbbreviations();
const Pos = CodeMirror.Pos;

function findMatchingAbbreviations(str, cursorLine, tokenEndCh) {
  console.log(str);
  str = str.toLowerCase();

  const matches = [];

  for (const [abbrKey, abbrValue] of abbreviations.entries()) {
    const caseInsensitiveAbbrKey = abbrKey.toLowerCase();

    for (let i = 0; i < abbrKey.length; i++) {
      if (str.endsWith(caseInsensitiveAbbrKey.slice(0, i + 1))) {
        matches.push({
          text: abbrValue,
          displayText: `${abbrValue}\t\t${abbrKey}`,
          from: Pos(cursorLine, tokenEndCh - (i + 1)),
          to: Pos(cursorLine, tokenEndCh)
        });
      }
    }
  }

  return matches;
}

CodeMirror.registerHelper("hint", "mmt", function(editor, options) {
  // Find the token at the cursor
  var cur = editor.getCursor();
  var token = editor.getTokenAt(cur);

  const matchingAbbreviations = findMatchingAbbreviations(token.string, cur.line, token.end);
  return {
    list: matchingAbbreviations,
    from: Pos(cur.line, token.start),
    to: Pos(cur.line, token.end)
  };
});


const editor = CodeMirror.fromTextArea(document.getElementById("code"), {
  mode: "mmt",
  lineNumbers: true,
  extraKeys: {"Ctrl-Space": "autocomplete"}
});

function getRawAbbreviations() {
  return `jMD|‚ùö
jDD|‚ùô
jOD|‚ùò
jsharp|‚ôØ
jflat|‚ô≠
jra|‚Üí
jla|‚Üê
jlra|‚Üî
jrA|‚áí
jlA|‚áê
jlrA|‚áî
jraa|‚ü∂
jlaa|‚üµ
jlraa|‚ü∑
jrAA|‚üπ
jlAA|‚ü∏
jlrAA|‚ü∫
jhra|‚Ü™
jhla|‚Ü©
jrightarrow|‚Üí
jleftarrow|‚Üê
jleftrightarrow|‚Üî
jRightarrow|‚áí
jLeftarrow|‚áê
jLeftrightarrow|‚áî
jhookrightarrow|‚Ü™
jhookleftarrow|‚Ü©
jlongrightarrow|‚ü∂
jlongleftarrow|‚üµ
jlongleftrightarrow|‚ü∑
jLongrightarrow|‚üπ
jLongleftarrow|‚ü∏
jLongleftrightarrow|‚ü∫
jbla|‚Ü¶
jblA|‚§á
jblaa|‚üº
jblAA|‚§á
jbra|‚Ü§
jbrA|‚§Ü
jbraa|‚üª
jbrAA|‚§Ü
jls|‚áù
jlss|‚üø
jrs|‚áú
jrss|‚¨≥
jmapsto|‚Ü¶
jMapsto|‚§á
jlongmapsto|‚üº
jLongmapsto|‚§á
jmapsfrom|‚Ü§
jMapsfrom|‚§Ü
jlongmapsfrom|‚üª
jLongmapsfrom|‚§Ü
jrightsquigarrow|‚áù
jlongrightsquigarrow|‚üø
jleftsquigarrow|‚áú
jlongleftsquigarrow|‚¨≥
jlolli|‚ä∏
jrewrites|‚üø
juparrow|‚Üë
jdownarrow|‚Üì
jupdownarrow|‚Üï
jUparrow|‚áë
jDownarrow|‚áì
jUpdownarrow|‚áï
jcontra|‚ÜØ
jcheck|‚úì
jast|‚àó
jstar|‚òÖ
jcdot|‚ãÖ
jcirc|‚àò
jbullet|‚àô
jtimes|√ó
jpm|¬±
jmp|‚àì
jdiv|√∑
jwedge|‚àß
jvee|‚à®
jcap|‚à©
jcup|‚à™
jsqcap|‚äì
jsqcup|‚äî
joplus|‚äï
jominus|‚äñ
jotimes|‚äó
joslash|‚äò
jodiv|‚®∏
joast|‚äõ
jocirc|‚äö
jodot|‚äô
joequal|‚äú
jo0|‚ì™
jo1|‚ë†
jo2|‚ë°
jo3|‚ë¢
jo4|‚ë£
jo5|‚ë§
jo6|‚ë•
jo7|‚ë¶
jo8|‚ëß
jo9|‚ë®
juplus|‚äé
judot|‚äç
jcapdot|‚©Ä
jcapbar|‚©É
jbigtimes|‚®â
jbigcirc|‚óØ
jbigwedge|‚ãÄ
jbigvee|‚ãÅ
jbigcap|‚ãÇ
jbigcup|‚ãÉ
jbigsqcap|‚®Ö
jbigsqcup|‚®Ü
jbigdiamond|‚óá
jbigoplus|‚®Å
jbigotimes|‚®Ç
jbiguplus|‚®Ñ
jbiguminus|‚©Å
jbigudot|‚®É
jbigubar|‚©Ç
jsubset|‚äÇ
jsupset|‚äÉ
jsq|‚äÜ
jsubseteq|‚äÜ
jsupseteq|‚äá
jnsubset|‚äÑ
jnsupset|‚äÖ
jnsubseteq|‚äà
jnsupseteq|‚äâ
jsubsetneq|‚ää
jsupsetneq|‚äã
jleq|‚â§
jgeq|‚â•
jll|‚â™
jgg|‚â´
jprec|‚â∫
jsucc|‚âª
jpreceq|‚âº
jsucceq|‚âΩ
jnleq|‚â®
jngeq|‚â©
jsqsubset|‚äè
jsqsupset|‚äê
jsubseteq|‚äë
jsupseteq|‚äí
jin|‚àà
jnin|‚àâ
jni|‚àã
jnni|‚àå
jneq|‚â†
jdoteq|‚âê
jbotdoteq|‚©¶
jbigeq|‚öå
jcirceq|‚âó
jtpeq|‚âò
jbpeq|‚âö
jdeltaeq|‚âú
jcorresponds|‚âô
jasteq|‚âõ
jqmeq|‚âü
jdotplus|‚àî
jplusdot|‚®•
jdotminus|‚à∏
jminusdot|‚®™
jdottimes|‚®∞
jdotsim|‚∏û
jsimdot|‚∏ü
jdotless|‚ãñ
jdotgreater|‚ãó
jdotsubset|‚™Ω
jdotsupset|‚™æ
jzsemi|‚®ü
jcirplus|‚®¢
jhatplus|‚®£
jsimplus|‚®§
jbarelem|‚ã∑
jequiv|‚â°
jnequiv|‚â¢
jsequiv|‚â£
jsim|‚àº
jsimeq|‚âÉ
jnsimeq|‚âÑ
jcong|‚âÖ
jncong|‚âá
japprox|‚âà
jnapprox|‚ââ
japproxeq|‚âä
jtriangleright|‚ñ∑
jtriangleleft|‚óÅ
jblacktriangleright|‚ñ∂
jblacktriangleleft|‚óÄ
jsmblksquare|‚ñ™
jsmwhtsquare|‚ñ´
jder|‚ä¶
jrightassert|‚ä¶
jvdash|‚ä¢
jdashv|‚ä£
jVdash|‚ä©
jVvdash|‚ä™
jmodels|‚äß
jModels|‚ä´
jtop|‚ä§
jbot|‚ä•
jneg|¬¨
jforall|‚àÄ
jexists|‚àÉ
jnexists|‚àÑ
jbox|‚ñ°
jsquare|‚ñ°
jdiamond|‚ãÑ
jes|‚àÖ
jemptyset|‚àÖ
jaleph|◊ê
jinfty|‚àû
jsum|‚àë
jprod|‚àè
jcoprod|‚àê
jamalg|‚àê
jcomp|‚àÅ
jcomplement|‚àÅ
jsm|‚àñ
jsetminus|‚àñ
jcolon|‚à∂
jzcolon|‚¶Ç
jcoloneq|‚âî
jeqcolon|‚âï
jlparen|(
jrparen|)
jllparen|‚∏®
jrrparen|‚∏©
jlwparen|‚¶Ö
jrwparen|‚¶Ü
jlbparen|‚¶á
jrbparen|‚¶à
jlhparen|‚ù™
jrhparen|‚ù´
jlangle|‚ü®
jrangle|‚ü©
jllangle|‚ü™
jrrangle|‚ü´
jrbangle|‚¶â
jlbangle|‚¶ä
jlhangle|‚ùÆ
jrhangle|‚ùØ
jlbracket|[
jrbracket|]
jllbracket|‚ü¶
jrrbracket|‚üß
jlmbracket|‚ÅÖ
jrmbracket|‚ÅÜ
jlubracket|‚¶ã
jrubracket|‚¶å
jlbrace|{
jrbrace|}
jlbbrace|‚¶É
jrbbrace|‚¶Ñ
jlhbrace|‚ù¥
jrhbrace|‚ùµ
jlflat|‚üÆ
jrflat|‚üØ
jllflat|‚ü¨
jrrflat|‚ü≠
jlfence|‚ßò
jrfence|‚ßô
jlceil|‚åà
jrceil|‚åâ
jlfloor|‚åä
jrfloor|‚åã
julcorner|‚åú
jurcorner|‚åù
jllcorner|‚åû
jlrcorner|‚åü
jldots|‚Ä¶
jvdots|‚ãÆ
jN|‚Ñï
jZ|‚Ñ§
jQ|‚Ñö
jR|‚Ñù
jC|‚ÑÇ
jB|‚Ñ¨
jpow|‚Ñò
jAlpha|Œë
jBeta|Œí
jGamma|Œì
jDelta|Œî
jEpsilon|Œï
jZeta|Œñ
jEta|Œó
jTheta|Œò
jIota|Œô
jKappa|Œö
jLambda|Œõ
jMu|Œú
jNu|Œù
jXi|Œû
jOmikron|Œü
jPi|Œ†
jRho|Œ°
jSigma|Œ£
jTau|Œ§
jUpsilon|Œ•
jPhi|Œ¶
jChi|Œß
jPsi|Œ®
jOmega|Œ©
jalpha|Œ±
jbeta|Œ≤
jgamma|Œ≥
jdelta|Œ¥
jepsilon|Œµ
jzeta|Œ∂
jeta|Œ∑
jtheta|œë
jiota|Œπ
jkappa|Œ∫
jlambda|Œª
jmu|Œº
jnu|ŒΩ
jxi|Œæ
jomikron|Œø
jpi|œÄ
jrho|œÅ
jsigma|œÉ
jtau|œÑ
jupsilon|œÖ
jphi|œÜ
jchi|œá
jpsi|œà
jomega|œâ
jsuper0|‚Å∞
jsuper1|¬π  
jsuper2|¬≤
jsuper3|¬≥
jsuper4|‚Å¥
jsuper5|‚Åµ
jsuper6|‚Å∂
jsuper7|‚Å∑
jsuper8|‚Å∏
jsuper9|‚Åπ
jsuperplus|‚Å∫
jsuperminus|‚Åª
jsuperequal|‚Åº
jsuperopen|‚ÅΩ
jsuperclose|‚Åæ
jsub0|‚ÇÄ
jsub1|‚ÇÅ
jsub2|‚ÇÇ
jsub3|‚ÇÉ
jsub4|‚ÇÑ
jsub5|‚ÇÖ
jsub6|‚ÇÜ
jsub7|‚Çá
jsub8|‚Çà
jsub9|‚Çâ
jsubplus|‚Çä
jsubminus|‚Çã
jsubequal|‚Çå
jsubopen|‚Çç
jsubclose|‚Çé
jprec|‚â∫
jpreceq|‚âº
jsucc|‚âª
jsucceq|‚âΩ
jnabla|‚àá
jpartial|‚àÇ
jdagger|‚Ä†
jint|‚à´
joint|‚àÆ
jln|„èë
jperp|‚üÇ
jparallel|‚à•
jnparallel|‚à¶
jURI|‚òû
// some of these have length 2 in Java and won't work everywhere
jU|ùí∞
jcalA|ùíú
jcalB|‚Ñ¨
jcalC|ùíû
jcalD|ùíü
jcalE|‚Ñ∞
jcalF|‚Ñ±
jcalG|ùí¢
jcalH|‚Ñã
jcalI|‚Ñê
jcalJ|ùí•
jcalK|ùí¶
jcalL|‚Ñí
jcalM|‚Ñ≥
jcalN|ùí©
jcalO|ùí™
jcalP|ùí´
jcalQ|ùí¨
jcalR|‚Ñõ
jcalS|ùíÆ
jcalT|ùíØ
jcalU|ùí∞
jcalV|ùí±
jcalW|ùí≤
jcalX|ùí≥
jcalY|ùí¥
jcalZ|ùíµ
jbbA|ùî∏
jbbB|ùîπ
jbbC|‚ÑÇ
jbbD|ùîª
jbbE|ùîº
jbbF|ùîΩ
jbbG|ùîæ
jbbH|‚Ñç
jbbI|ùïÄ
jbbJ|ùïÅ
jbbK|ùïÇ
jbbL|ùïÉ
jbbM|ùïÑ
jbbN|‚Ñï
jbbO|ùïÜ
jbbP|‚Ñô
jbbQ|‚Ñö
jbbR|‚Ñù
jbbS|ùïä
jbbT|ùïã
jbbU|ùïå
jbbV|ùïç
jbbW|ùïé
jbbX|ùïè
jbbY|ùïê
jbbZ|‚Ñ§`;
}
</script>

</article>

</body>
</html>